<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Chapter 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="../site_libs/datatables-binding-0.33/datatables.js"></script>

<script src="../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="../site_libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">

<script src="../site_libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#outline-of-the-course-notes" id="toc-outline-of-the-course-notes" class="nav-link" data-scroll-target="#outline-of-the-course-notes">Outline of the course notes</a></li>
  <li><a href="#data-and-the-data-matrix" id="toc-data-and-the-data-matrix" class="nav-link" data-scroll-target="#data-and-the-data-matrix">Data and the data matrix</a></li>
  <li><a href="#standardisation-of-data" id="toc-standardisation-of-data" class="nav-link" data-scroll-target="#standardisation-of-data">Standardisation of data</a></li>
  <li><a href="#introduction-to-singular-value-decomposition-svd" id="toc-introduction-to-singular-value-decomposition-svd" class="nav-link" data-scroll-target="#introduction-to-singular-value-decomposition-svd">Introduction to Singular Value Decomposition (SVD)</a>
  <ul class="collapse">
  <li><a href="#mathematical-definition" id="toc-mathematical-definition" class="nav-link" data-scroll-target="#mathematical-definition">Mathematical Definition</a></li>
  </ul></li>
  <li><a href="#dimension-reduction" id="toc-dimension-reduction" class="nav-link" data-scroll-target="#dimension-reduction">Dimension Reduction</a>
  <ul class="collapse">
  <li><a href="#least-squares-approximation" id="toc-least-squares-approximation" class="nav-link" data-scroll-target="#least-squares-approximation">Least Squares Approximation</a></li>
  </ul></li>
  <li><a href="#r-programming-exercise" id="toc-r-programming-exercise" class="nav-link" data-scroll-target="#r-programming-exercise">R Programming Exercise</a></li>
  <li><a href="#a-word-of-caution-on-practical-data-analysis" id="toc-a-word-of-caution-on-practical-data-analysis" class="nav-link" data-scroll-target="#a-word-of-caution-on-practical-data-analysis">A word of caution on practical data analysis</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="chapter1.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="chapter1.slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Chapter 1</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Reading">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reading
</div>
</div>
<div class="callout-body-container callout-body">
<p>Course Notes - Chapter Introduction</p>
</div>
</div>
<p>Most quantitative research in the business and social sciences makes use of some kind of multivariate analysis. Research that considers only one variable at a time (a <em>univariate</em> analysis) can provide useful information – for example, about the average rate of inflation over time, the variability of a particular share’s return, or the relative proportion of the population that hold a certain opinion – but it is usually in the consideration of <em>relationships</em> between two or more variables that the most interesting and useful information is to be found. For example, what other variables are related to increases in the inflation rate or the rise in the price of a particular share? Is it interest rates? Foreign exchange rates? And what causes people to prefer one opinion over another? Is it their education level? Income? The newspaper they read? Simply put, any analysis that considers the relationship between two or more variables is a <em>multivariate</em> analysis.</p>
<p>The aim of this course and these notes is to cover some of the more popular methods for exploring multivariate data. The perspective that we will take when looking at these techniques will be to use the minimum amount of mathematics necessary for a solid understanding of the techniques and their interpretation. However, this does not mean “no mathematics”! Over the past twenty or so years, modern statistical software packages have made it possible to run all of the techniques that we’ll cover in this course with a few clicks of a mouse, without knowing a single bit of mathematics and almost nothing about how the techniques themselves work. Clicking a mouse might give you results, but it is very difficult to know whether these results are reliable unless you know something about the underlying technique and what potential pitfalls exist. All statistical techniques, and particularly the multivariate ones, make some assumptions about the type and amount of data that should be collected and the aims of the researcher. If these are ignored, the results may not just be incorrect but misleading. In this case it would be better to put the output of an analysis in a rubbish bin than into a report or on a manager’s desk. To get this understanding, a certain amount of mathematics is needed.</p>
<p>Having said that, the focus of the course is on the practical use and interpretation of the techniques in the analysis of real-world business and social research. The course is aimed at students who are specialising in some field of business or social science but who are not specialising in statistics, and so the techniques are illustrated mostly using real-world numerical examples rather than using mathematical arguments. The kind of statistics and mathematics that will used includes the following topics that have been covered in previous courses:</p>
<p>If you are unfamiliar with any of this material, it is important to go back and revise in the first few weeks of the course.</p>
</section>
<section id="outline-of-the-course-notes" class="level2">
<h2 class="anchored" data-anchor-id="outline-of-the-course-notes">Outline of the course notes</h2>
<p>Apart from this general introduction chapter, the course is divided into two parts of roughly equal size. In the first part, we look at techniques that a primarily ways of summarising large amounts of data and extracting its key meaning. Summarisation is concerned with taking a large amount of data and condensing it into a simpler form that is easier to read and understand. Everyone is familiar with the idea of a “summary” section at the back of a textbook chapter, which gives the key ideas contained in the chapter. You can think of the techniques contained in the first part of the course as a summary section for numbers. We look at three techniques in Part I: correspondence analysis, factor analysis, and cluster analysis. Importantly, the techniques in Part I do not attempt to predict anything, nor explain any dependent variable. In fact, there is no dependent variable for any of the techniques in part one. This is left until Part II, which deals with what we will call “predictive” techniques. These techniques attempt to use one set of variables (the independent or predictor variables) to predict one of more other variables (the dependent or outcome variables). Multiple regression, which you would have covered in previous courses, is a typical example of a predictive technique, which we will briefly look at in this course in order to introduce other predictive models. The other techniques we will look at in Part II are: analysis of variance and covariance, discriminant analysis, classification trees, and structural equation modelling. Thus, over the course of the semester we aim to cover nine techniques which cover the bulk of multivariate analyses done in business- and social-research industries today.</p>
<p>Each technique is illustrated with a detailed example, with more concise descriptions of further examples given in the final part of each chapter, called “Further examples”. These are intended as a basis for discussion in class or for self-study. For the practical implementation of the methods studied in this course, the R software package will be used. The R system is an open-source software project for analysing data and constructing graphics. It provides a general computer language for performing tasks like organizing data, statistical analyses, simulation studies, model fitting, building of complex graphics and many more. The R language was introduced in 1996, but in the first decade of the twenty-first century interest in R has exceeded all possible expectations. Apart from a well maintained core system with new releases every few months there are currently literally thousands of researchers contributing add-on packages on cutting-edge developments in statistics and data analysis. R is available in the Scilabs on campus. If you would like to install R on your own laptop / PC, go to the website <a href="http://www.R-project.org" class="uri">http://www.R-project.org</a>. To download R to your own computer: Navigate to …./bin/windows/base and save the file R-x.0.x.-win.exe on your computer. Click this file to start the installation procedure and select the defaults unless you have a good reason not to do so. The core R system that is installed includes several packages. Apart from these installed packages several thousands of dedicated contributed packages are available to be downloaded by users in need of specific analyses. Many users of R prefer working with RStudio. This is a free and open source integrated development environment for R which works with the standard version of R available from CRAN (Comprehensive R Archive Network available at the website address given above). It can be downloaded from the RStudio home page <a href="www.rstudio.com">www.rstudio.com</a> to be run from your desktop (Windows, Mac or Linux). In this course we will be using the RStudio environment.</p>
<p>Before diving into the techniques, it is necessary to make sure that everyone is on the same mathematical footing, at least as far as basics are concerned. The remainder of this section revises some of the most important ideas behind matrices and the data filling them, and describes how mathematical notation will be used in the remainder of the notes. It may be useful to have a quick read through these sections now to see how familiar you are with the content, and then to refer back to them as you read through the chapters to come.</p>
</section>
<section id="data-and-the-data-matrix" class="level2">
<h2 class="anchored" data-anchor-id="data-and-the-data-matrix">Data and the data matrix</h2>
<p>In earlier mathematics courses, you would have learned that a <em>matrix</em> is simply a rectangular or square arrangement of numbers. For example,</p>
<p><span class="math display">\[
\mathbf{X} = \begin{bmatrix}
10 &amp; 3 &amp; 49 &amp; 23 \\
9 &amp; 20 &amp; 94 &amp; 1
\end{bmatrix}
\]</span></p>
<p>is a matrix. Specifically it is a matrix with dimension <span class="math inline">\(2\times 4\)</span>, or a “<span class="math inline">\(2\times 4\)</span> matrix” for short, because it has two rows and four columns. A <em>vector</em> is a special case of a matrix with only one row (called a row vector) or one column (called a column vector). Of course, any number on its own is also a special case of a matrix; one with one row <em>and</em> one column. This is called a <em>scalar</em>.</p>
<p>If we want to talk generally about matrices, without referring to specific number like in the matrix above, it is common to use <span class="math inline">\(x\)</span>’s in place of the numbers in the matrix e.g.</p>
<p><span class="math display">\[
\mathbf{X} = \begin{bmatrix}
x_{11} &amp; x_{12} &amp; x_{13} &amp; x_{14}\\
x_{21} &amp; x_{22} &amp; x_{23} &amp; x_{24}
\end{bmatrix}
\]</span></p>
<p>The whole matrix is usually denoted with a bold capital i.e.&nbsp;<span class="math inline">\(\mathbf{X}\)</span>. It is important to realise that each <span class="math inline">\(x\)</span> in the matrix above is simply a placeholder for a particular value to come. The first matrix (with the numbers) can <em>only</em> refer to one particular matrix, but the second one (with the <span class="math inline">\(x\)</span>’s) can be used to refer to <em>any</em> <span class="math inline">\(2\times 4\)</span> matrix. Also, we can refer to any position in the <span class="math inline">\(\mathbf{X}\)</span> matrix using subscript notation.</p>
<p>Take <span class="math inline">\(x_{23}\)</span> for example. The “23” is actually two subscripts put together (a “2” and a “3”). The first subscript (the “2”) indicates what row the particular <span class="math inline">\(x\)</span> we are interested in is in (the second row), and the second subscript (the “3”) indicates what column the <span class="math inline">\(x\)</span> is in (the third column). In the first matrix above, <span class="math inline">\(x_{23}=94\)</span>. Of course, if we have a vector, then there will be only one subscript, because all elements are in the same row (or column if it is a column vector). In fact, there is nothing stopping us having more than two subscripts too (for matrices of more than two dimensions), but we will not need to go this extra step for this course.</p>
<p>Why are we going over all this? Suppose that we have given out a survey and collected responses from 6 people on 5 questions. We can arrange these responses in the format of a table, as shown below:</p>
<p><span class="math display">\[
\mathbf{X} = \begin{bmatrix}
x_{11} &amp; x_{12} &amp; x_{13} &amp; x_{14} &amp; x_{15} \\
x_{21} &amp; x_{22} &amp; x_{23} &amp; x_{24} &amp; x_{25} \\
x_{31} &amp; x_{32} &amp; x_{33} &amp; x_{34} &amp; x_{35} \\
x_{41} &amp; x_{42} &amp; x_{43} &amp; x_{44} &amp; x_{45} \\
x_{51} &amp; x_{52} &amp; x_{53} &amp; x_{54} &amp; x_{55} \\
x_{61} &amp; x_{62} &amp; x_{63} &amp; x_{64} &amp; x_{65}
\end{bmatrix}
\]</span></p>
<p>We will call a table or matrix that is set up like this to contain data collected from a survey or some other piece of research a <em>data table</em> or a <em>data matrix</em>. There is not real difference between it an the other matrices we were talking about earlier, just a special application. The things that we are collecting data from (which could be people, shares, countries, animal species, songs <span class="math inline">\(\dots\)</span> anything you can collect data on) are called <em>cases</em> or <em>responses</em>. These appear as separate <em>rows</em> in the data matrix. The pieces of information that we use to describe each case are called <em>variables</em> or <em>attributes</em> and these appear in the <em>columns</em> of the data matrix. The <span class="math inline">\(x\)</span>’s, remember, are simply placeholders for values to come. Specifically, the values to come may be numbers, or they may be words. It is perfectly allowable for the first column of <span class="math inline">\(x\)</span>’s to be, for example, the first names of each person, e.g.&nbsp;<span class="math inline">\(x_{11}=\text{Iris}\)</span>. Of course, this will affect the type of analysis we can do later on that variable (for example, it wouldn’t make sense to calculate a mean’ first name).</p>
<p><code>R</code> makes a distinction between matrices of numeric values and data frames containing all different types of data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/survey.data.RData"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>survey.data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Person Q1     Q2       Q3       Q4 Q5
1   John  6 639020 52.82732 21.91701 16
2  Sally  1 153860 47.71114 17.41023 14
3   Jane  4 138180 51.62570 21.96218 16
4    Tom  2 101360 48.69179 18.88657 13
5   Rick  2 564000 48.81529 19.48836 11
6    Amy  3 328830 49.02871 21.84143  9</code></pre>
</div>
</div>
<p>Above we have a data frame called survey.data. We can ask <code>R</code> whether survey.data is a data frame with the function <code>is.data.frame()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.data.frame</span>(survey.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>We can ask <code>R</code> whether <code>survey.data</code> is a matrix with the function <code>is.matrix()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.matrix</span>(survey.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>We can convert a data frame to a matrix with the function <code>as.matrix()</code>. Similarly, a matrix can be converted into a data frame with the function <code>as.data.frame()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(survey.data[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Q1     Q2       Q3       Q4 Q5
[1,]  6 639020 52.82732 21.91701 16
[2,]  1 153860 47.71114 17.41023 14
[3,]  4 138180 51.62570 21.96218 16
[4,]  2 101360 48.69179 18.88657 13
[5,]  2 564000 48.81529 19.48836 11
[6,]  3 328830 49.02871 21.84143  9</code></pre>
</div>
</div>
<p>Above we have the matrix called <code>X</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.data.frame</span>(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.matrix</span>(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Notice that when the matrix <code>X</code> was created from the data frame survey.data, the first column, containing non-numeric values were excluded. Has it not been excluded, all entries in the matrix will be converted to text, even the numeric values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(survey.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Person  Q1  Q2       Q3         Q4         Q5  
[1,] "John"  "6" "639020" "52.82732" "21.91701" "16"
[2,] "Sally" "1" "153860" "47.71114" "17.41023" "14"
[3,] "Jane"  "4" "138180" "51.62570" "21.96218" "16"
[4,] "Tom"   "2" "101360" "48.69179" "18.88657" "13"
[5,] "Rick"  "2" "564000" "48.81529" "19.48836" "11"
[6,] "Amy"   "3" "328830" "49.02871" "21.84143" " 9"</code></pre>
</div>
</div>
<p>At this point it is probably worth spending a little time discussing different data types. There are two main types of data that we need to distinguish between: <em>numerical</em> variables, and <em>categorical</em> variables.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Numerical variables</p>
<p><strong>Numerical variables</strong> are measurements that can be recorded on a quantitative scale where the intervals between two values on the scale have some meaning. Essentially, this means that (a) the variable contains numbers rather than words or symbols, (b) the gaps between two numbers have some actual meaning. Examples of numerical variables are height, age, and number of children.</p>
<p><strong>Categorical variables</strong> are measurements of individuals in terms of groups or categories where the gap between categories have no intrinsic meaning. A typical example of a categorical variable is race, where the gap betweenblack’ and white’ has no proper interpretation, language, political affiliation, country of birth, and many other demographic variables.</p>
</div>
</div>
<p>It is vitally important to be able to distinguish between different data types because to a large extent these dictate what statistical techniques can be used. For example, it makes good sense to calculate the mean of a continuous variable but (as we have seen) no sense at all to calculate the mean of a categorical variable. The same idea extends to multivariate analysis. Some of the techniques we will look at work on correlation coefficients, which cannot be calculated for strictly categorical variables like race.</p>
<p>One further point on data types: some textbooks further divide numerical variables into <em>ratio-scaled</em> numerical variables and <em>interval-scaled</em> numerical variables; and divide categorical variables into <em>ordinal</em> categorical variables and <em>nominal</em> categorical variables. For the purposes of deciding which multivariate technique to use, this is an unnecessary detail and it is sufficient to know whether a variable is numerical or categorical. For the sake of completeness these additional terms are briefly described below. Ratio-scaled numerical variables are those that have a natural zero point (like age, height, and income). These are called “ratio-scaled” because the are not sensitive to units of measurement (if I am three times your height in meters I am also three times your height if it is measured in centimeters). This means that ratio-scaled variables have an arbitrary scale. Interval-scaled variables are still numeric but do not have a natural zero point (IQ, temperature in degrees Celcius, and most Likert-type rating scales are of this type). Interval-scaled variables therefore have an arbitrary zero point <em>and</em> an arbitrary scale. Ordinal categorical variables are those where the categories can be ordered even if the gaps between them cannot be interpreted (such as level of education, which can be ordered: none, primary-school, high-school, undergraduate degree, postgraduate degree). In contrast, the categories of a nominal categorical variable cannot be ordered in any meaningful way (such as race or language group). It is also common to further classify numerical variables as <em>continuous</em> if they can take on any intermediate value on the scale (e.g.&nbsp;height) or <em>discrete</em> if the values a variable can take on are limited in some way (e.g.&nbsp;number of children).</p>
</section>
<section id="standardisation-of-data" class="level2">
<h2 class="anchored" data-anchor-id="standardisation-of-data">Standardisation of data</h2>
<p>When analysing numerical data, it often happens that different variables are measured on scales of very different sizes. For example, in the above matrix the first question might ask one how many children one has and the second question might ask for one’s income in Rands. Clearly, the scale of possible values for the first question (between 0 and perhaps 15) is <em>much</em> smaller than for the second (between 0 and perhaps several million Rand). For reasons that will become clearer later on, this can cause enormous problems in some multivariate techniques by giving too much influence to the variables measured on larger scales. In order to put all variables on an equal footing, it is often necessary to <em>standardise</em> the data. Because several techniques require standardised data we consider it in this introductory chapter, but it is important to realise that <em>not all</em> the techniques need the data to be standardised. Moreover, in cases where all numerical variables are measured on the same scale (e.g.all on a 1 to 5 Likert rating scale) there will be no need to standardise either.</p>
<p>There are several different ways to standardise data, but the only one that we will use is to standardise the data so that each variable has a mean of zero and a standard deviation of one. In order to do this we carry out the following steps:</p>
<p>We will illustrate the standardisation of a data matrix using the following example. Suppose that information on three variables (income, number of children, and age) has been collected from five individuals. The data is contained in the following table.</p>
<div id="tbl-unstd" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-unstd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Unstandardized Data with Summary Statistics
</figcaption>
<div aria-describedby="tbl-unstd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">Person</th>
<th style="text-align: center;">Income</th>
<th style="text-align: center;">No Children</th>
<th style="text-align: center;">Age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(a\)</span></td>
<td style="text-align: center;">10000</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">40</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(b\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">23</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(c\)</span></td>
<td style="text-align: center;">300000</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">32</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(d\)</span></td>
<td style="text-align: center;">150000</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">35</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(e\)</span></td>
<td style="text-align: center;">1000000</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">58</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\bar{x}\)</span></td>
<td style="text-align: center;">292000</td>
<td style="text-align: center;">1.6</td>
<td style="text-align: center;">37.6</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(s\)</span></td>
<td style="text-align: center;">414210</td>
<td style="text-align: center;">1.140</td>
<td style="text-align: center;">12.973</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>where we use the usual mathematical notation <span class="math inline">\(\bar{x}\)</span> to denote the mean and <span class="math inline">\(s\)</span> to denote the standard deviation. Note that the variables are measured on very different scales. To standardise the data, we simply follow the steps above. For example, the standardised income of person <span class="math inline">\(a\)</span> is given by <span class="math display">\[\frac{10\,000-292\,000}{414\,210}=-0.681\]</span> to three decimal places. Similarly the standardised number of children for person <span class="math inline">\(d\)</span> is given by <span class="math inline">\((2-1.6)/1.140=0.351\)</span>. You can check for yourself that the <em>new</em> column means and standard deviations are all zero and one respectively. Since the mean of all the variables is zero, it is possible to see at a glance which observations are below average (those that are negative) and which are above average (those that are positive).</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-817839e7277579f83991" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-817839e7277579f83991">{"x":{"filter":"none","vertical":false,"class":"display","data":[["a","b","c","d","e"],[-0.681,-0.705,0.019,-0.343,1.709],[-1.403,1.228,0.351,0.351,-0.526],[0.185,-1.125,-0.432,-0.2,1.572]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th rowspan=\"2\">Person<\/th>\n      <th colspan=\"3\" style=\"text-align: center;\">Standardised data<\/th>\n    <\/tr>\n    <tr>\n      <th>Income<\/th>\n      <th>N.Children<\/th>\n      <th>Age<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"targets":1,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"className":"dt-center","targets":"_all"},{"name":"Person","targets":0},{"name":"Income","targets":1},{"name":"N.Children","targets":2},{"name":"Age","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
</div>
</div>
<p>The relevance of standardising data may not seem clear to you at the moment. Just bear this section in mind as you continue through the notes and refer back to it when the issue of standardisation reappears.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span> (<span class="fu">c</span>(<span class="dv">10000</span>,<span class="dv">0</span>,<span class="dv">300000</span>,<span class="dv">150000</span>,<span class="dv">1000000</span>,<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">40</span>,<span class="dv">23</span>,<span class="dv">32</span>,<span class="dv">35</span>,<span class="dv">58</span>), <span class="at">ncol=</span><span class="dv">3</span>,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">dimnames=</span><span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span>,<span class="st">"d"</span>,<span class="st">"e"</span>), </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">c</span>(<span class="st">"Income"</span>,<span class="st">"No Children"</span>,<span class="st">"Age"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>In R we can create a matrix with the <code>matrix()</code> function. The values in the matrix are concatenated with the operator <code>c()</code>. Notice that the values needs to be entered column wise by default. The names for the two dimensions are specified by <code>dimnames=list(“row names”, “column names”)</code>. Notice below that the row names appear to the left.</em></p>
<p><em>They are text, but are not part of the CONTENT of the matrix. The matrix X:5 × 3 contains only numeric values.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Income No Children Age
a   10000           0  40
b       0           3  23
c  300000           2  32
d  150000           2  35
e 1000000           1  58</code></pre>
</div>
</div>
<p>To calculate the means we apply to X, column wise (indicated by 2; 1 for row wise) the function <code>mean()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">apply</span>(X,<span class="dv">2</span>,mean)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>xbar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Income No Children         Age 
   292000.0         1.6        37.6 </code></pre>
</div>
</div>
<p>Similarly, the function <code>sd()</code> is applied to each column to calculate the standard deviations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">apply</span>(X,<span class="dv">2</span>,sd)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Income  No Children          Age 
4.142101e+05 1.140175e+00 1.297305e+01 </code></pre>
</div>
</div>
<p>Any numeric calculations can be performed by simply typing the expression at the R command prompt “<code>&gt;</code>”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">10000-292000</span>)<span class="sc">/</span><span class="dv">414210</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.6808141</code></pre>
</div>
</div>
<p>R has the ability to operate on a whole vector (or matrix) at once. Here the standardised values for Age is calculated by subtracting the mean from the values in column 2 and dividing resulting “column minus mean” by the standard deviation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>(X[,<span class="dv">2</span>]<span class="sc">-</span><span class="fl">1.6</span>)<span class="sc">/</span><span class="fl">1.14</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         a          b          c          d          e 
-1.4035088  1.2280702  0.3508772  0.3508772 -0.5263158 </code></pre>
</div>
</div>
<p>The expressions above is simply for illustration purposes. The function <code>scale()</code> performs all the standardisation calculations in a single step. The output is again a matrix of size 5 × 3, but additional attributes are provided: first the mean called “<code>scaled:center</code>”, then the standard deviations called “<code>scaled:scale</code>”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scale</span>(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Income No Children        Age
a -0.68081393  -1.4032928  0.1849989
b -0.70495627   1.2278812 -1.1254101
c  0.01931387   0.3508232 -0.4316641
d -0.34282120   0.3508232 -0.2004155
e  1.70927752  -0.5262348  1.5724908
attr(,"scaled:center")
     Income No Children         Age 
   292000.0         1.6        37.6 
attr(,"scaled:scale")
      Income  No Children          Age 
4.142101e+05 1.140175e+00 1.297305e+01 </code></pre>
</div>
</div>
<p>Let us begin by taking another look at the general <span class="math inline">\(\mathbf{X}\)</span> matrix from earlier in the chapter.</p>
<p><span class="math display">\[
\mathbf{X} = \begin{bmatrix}
x_{11} &amp; x_{12} &amp; x_{13} &amp; x_{14} &amp; x_{15} \\
x_{21} &amp; x_{22} &amp; x_{23} &amp; x_{24} &amp; x_{25} \\
x_{31} &amp; x_{32} &amp; x_{33} &amp; x_{34} &amp; x_{35} \\
x_{41} &amp; x_{42} &amp; x_{43} &amp; x_{44} &amp; x_{45} \\
x_{51} &amp; x_{52} &amp; x_{53} &amp; x_{54} &amp; x_{55} \\
x_{61} &amp; x_{62} &amp; x_{63} &amp; x_{64} &amp; x_{65}
\end{bmatrix}
\]</span></p>
<p>We have already discussed the use of subscript notation, using the example of <span class="math inline">\(x_{23}\)</span> – where the first subscript that the <span class="math inline">\(x\)</span> we are interested in is in the second row and the third column of the data matrix. We can make this one step more general by referring to a general subscript <span class="math inline">\(i\)</span> for the rows and <span class="math inline">\(j\)</span> for the columns, to give <span class="math inline">\(x_{ij}\)</span>. In the same way that the <span class="math inline">\(x\)</span>’s are just placeholders for value to come, so is <span class="math inline">\(i\)</span> and so is <span class="math inline">\(j\)</span>. Thus, we can insert any value from 1 to 6 into <span class="math inline">\(i\)</span> and any value from 1 to 5 into <span class="math inline">\(j\)</span>, and refer to a specific element of <span class="math inline">\(\mathbf{X}\)</span>.</p>
<p>This becomes important because we don’t want to have to write out the whole matrix every time we want to do something with <span class="math inline">\(\mathbf{X}\)</span>. The general <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> subscripts allow us to be much more concise. For example, suppose that the <span class="math inline">\(x\)</span>’s are scores on 5 different tests. The score achieved by student <span class="math inline">\(i\)</span> on test <span class="math inline">\(j\)</span> is given by <span class="math inline">\(x_{ij}\)</span>. Suppose now that we want to find student 3’s average mark, which we label as <span class="math inline">\(\bar{x}_3\)</span>. In order to do this we need to add up all 5 test scores and divide by 5. We could write <span class="math display">\[\bar{x}_3=\frac{x_{31}+x_{32}+x_{33}+x_{34}+x_{35}}{5}\]</span> or we could write <span class="math display">\[\bar{x}_3=\frac{1}{5}\sum_{j=1}^5 x_{3j}\]</span> The summation sign <span class="math inline">\((\Sigma)\)</span> indicates that we add up all the terms following the sign, by letting <span class="math inline">\(j\)</span> take each of the values in turn between the “limits of summation” (which are 1 and 5 respectively). In this case, it does not save much time or space to use summation notation, but in some cases it does. For example, if we now want refer to the average test score of <em>any</em> of the individuals in our data set, we have two choices: either use the “full” notation and write out all the averages <span class="math display">\[\begin{align*}
\bar{x}_1&amp;=(x_{11}+x_{12}+x_{13}+x_{14}+x_{15})/5 \\
\bar{x}_2&amp;=(x_{21}+x_{22}+x_{23}+x_{24}+x_{25})/5 \\
\bar{x}_3&amp;=(x_{31}+x_{32}+x_{33}+x_{34}+x_{35})/5 \\
\bar{x}_4&amp;=(x_{41}+x_{42}+x_{43}+x_{44}+x_{45})/5 \\
\bar{x}_5&amp;=(x_{51}+x_{52}+x_{53}+x_{54}+x_{55})/5 \\
\bar{x}_6&amp;=(x_{61}+x_{62}+x_{63}+x_{64}+x_{65})/5
\end{align*}\]</span> or use the other general subscript <span class="math inline">\(i\)</span> and write the average test score of person <span class="math inline">\(i\)</span> is given by <span class="math display">\[\bar{x}_i=\frac{1}{5}\sum_{j=1}^5 x_{ij}\hspace{4em}(i=1,\dots,6)\]</span> where the <span class="math inline">\((i=1,\dots,6)\)</span> part indicates that <span class="math inline">\(i\)</span> can take on any value from 1 to 6. The compactness of the summation notation is clear to see. Now, suppose that we want to weight the different test scores differently. This is typically what happens in the calculation of a year mark. Suppose that the <span class="math inline">\(x\)</span>’s are marks are 5 class tests, which are count <span class="math inline">\(w_1\)</span>, <span class="math inline">\(w_2\)</span>, <span class="math inline">\(w_3\)</span>, <span class="math inline">\(w_4\)</span>, <span class="math inline">\(w_5\)</span> towards the final mark. Note that we have introduced another variable here, <span class="math inline">\(w_j\)</span>, to denote the weight attached to test <span class="math inline">\(j\)</span>. Then the year mark obtained by student <span class="math inline">\(i\)</span> is given by</p>
<p><span class="math display">\[\bar{x}_i=\frac{w_1x_{i1}+w_2x_{i2}+w_3x_{i3}+w_4x_{i4}+w_5x_{i5}}{5}\hspace{4em}(i=1,\dots,6)\]</span> or we could just write <span class="math display">\[\bar{x}_i=\frac{1}{5}\sum_{j=1}^5 w_jx_{ij}\hspace{4em}(i=1,\dots,6)\]</span> Note that the <span class="math inline">\(w\)</span>’s only have a <span class="math inline">\(j\)</span> subscript because they do not differ over students (the weighting is the same for all students) and so do not need an <span class="math inline">\(i\)</span> subscript. Suppose that the weightings <em>did</em> differ over students (say because the weights needed to be adjusted if students miss a test for medical reasons). Then the <span class="math inline">\(w\)</span>’s would be able to differ over students, we would need to include a subscript <span class="math inline">\(i\)</span>, and we would have an average mark given by <span class="math display">\[\bar{x}_i=\frac{1}{5}\sum_{j=1}^5 w_{ij}x_{ij}\hspace{4em}(i=1,\dots,6)\]</span> Try writing out the average year mark for student 4 as a practice exercise. Finally, suppose that we want to work out a class average, labelled <span class="math inline">\(C\)</span>. For this we need to add together each student’s average mark <span class="math inline">\(\bar{x}_i\)</span> and then divide by the number of students in the class, 6. This can be written as</p>
<p><span class="math display">\[C=\sum_{i=1}^6 \bar{x}_i=\frac{1}{6}\sum_{i=1}^6 \frac{1}{5}\sum_{j=1}^5 w_{ij}x_{ij}=\frac{1}{30}\sum_{i=1}^6 \sum_{j=1}^5 w_{ij}x_{ij}\hspace{4em}(i=1,\dots,6)\]</span> Once again, try writing this out in full as an exercise and to see the usefulness of the summarised notation!</p>
</section>
<section id="introduction-to-singular-value-decomposition-svd" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-singular-value-decomposition-svd">Introduction to Singular Value Decomposition (SVD)</h2>
<p>There is one result from matrix algebra that we will use extensively in the methods discussed in this course. Without going into the detail of the mathematics, the <strong>singular value decomposition (SVD)</strong> can be viewed as a “black box”. The results of the SVD can be stated in terms of matrices or individual elements of a matrix.</p>
<section id="mathematical-definition" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-definition">Mathematical Definition</h3>
<p>Any matrix <span class="math inline">\(\mathbf{X}\)</span> can be expressed as the product of three matrices <span class="math inline">\(\mathbf{U}\)</span>, <span class="math inline">\(\mathbf{D}\)</span>, and <span class="math inline">\(\mathbf{V}'\)</span>. The <span class="math inline">\(ij\)</span>-th element of <span class="math inline">\(\mathbf{X}\)</span>, denoted as <span class="math inline">\(x_{ij}\)</span>, is expressed as:</p>
<p><span class="math display">\[x_{ij} = \sum_{k=1}^r u_{ik} d_k v_{jk}\]</span></p>
<p>The values <span class="math inline">\(d_k\)</span> have only one subscript because the matrix <span class="math inline">\(\mathbf{D}\)</span> is a <strong>diagonal matrix</strong> with zeros for all off-diagonal elements.</p>
<p>If <span class="math inline">\(\mathbf{X}\)</span> is the matrix of standardised data (e.g., Income, Number of Children, and Age), then <span class="math inline">\(r=3\)</span>, and <span class="math inline">\(\mathbf{D}\)</span> will contain three diagonal values. These values in <span class="math inline">\(\mathbf{D}\)</span> are called the <strong>singular values</strong>. Singular values are always non-negative (<span class="math inline">\(d_k \ge 0\)</span>), and we order them such that <span class="math inline">\(d_1 \ge d_2 \ge \dots \ge d_r\)</span>.</p>
<hr>
</section>
</section>
<section id="dimension-reduction" class="level2">
<h2 class="anchored" data-anchor-id="dimension-reduction">Dimension Reduction</h2>
<p>The SVD is the basis for approximating multivariate data by <strong>dimension reduction</strong>. Working with too many variables makes it difficult to discern interrelationships. We often seek a matrix <span class="math inline">\(\mathbf{X}^*\)</span> that is “simpler” than <span class="math inline">\(\mathbf{X}\)</span> but remains a good approximation.</p>
<section id="least-squares-approximation" class="level3">
<h3 class="anchored" data-anchor-id="least-squares-approximation">Least Squares Approximation</h3>
<p>We aim to find the least squares solution <span class="math inline">\(\mathbf{X}^*\)</span> that minimizes the sum of squared differences between the elements of <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{X}^*\)</span>:</p>
<p><span class="math display">\[\min \sum_{i} \sum_{j} (x_{ij} - x_{ij}^*)^2\]</span></p>
<p>According to <strong>Huygens’ Principle</strong>, the approximation necessarily includes the centroid (mean), so we center the data matrix before approximating. If the data is already standardised, it is already centered.</p>
<p><strong>Best 2D approximation:</strong> <span class="math inline">\(\mathbf{X}^* = \sum_{k=1}^2 u_{ik} d_k v_{jk}\)</span> <strong>Best 1D approximation:</strong> <span class="math inline">\(\mathbf{X}^* = u_{i1} d_1 v_{j1}\)</span></p>
<hr>
</section>
</section>
<section id="r-programming-exercise" class="level2">
<h2 class="anchored" data-anchor-id="r-programming-exercise">R Programming Exercise</h2>
<p>Use the interactive console below to perform the SVD on a standardized dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Create the sample data matrix X</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">2</span>, <span class="dv">35</span>, </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>              <span class="dv">20</span>, <span class="dv">4</span>, <span class="dv">45</span>, </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>              <span class="dv">40</span>, <span class="dv">3</span>, <span class="dv">30</span>, </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>              <span class="dv">35</span>, <span class="dv">3</span>, <span class="dv">32</span>, </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>              <span class="dv">60</span>, <span class="dv">5</span>, <span class="dv">25</span>), </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">nrow =</span> <span class="dv">5</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Income"</span>, <span class="st">"Children"</span>, <span class="st">"Age"</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Standardise the matrix</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>X.std <span class="ot">&lt;-</span> <span class="fu">scale</span>(X)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Compute SVD</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>res.svd <span class="ot">&lt;-</span> <span class="fu">svd</span>(X.std)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract components</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> res.svd<span class="sc">$</span>u</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">diag</span>(res.svd<span class="sc">$</span>d)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> res.svd<span class="sc">$</span>v</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Construct the best 2-dimensional approximation (X.star)</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co"># We use only the first two columns/elements</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>X.star <span class="ot">&lt;-</span> U[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">%*%</span> D[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">%*%</span> <span class="fu">t</span>(V[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co"># View results</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Standardized Matrix:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Standardized Matrix:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(X.std)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Income   Children        Age
[1,]  0.59344243 -1.2278812  0.2151580
[2,] -1.38469899  0.5262348  1.5598952
[3,] -0.06593805 -0.3508232 -0.4572107
[4,] -0.39562828 -0.3508232 -0.1882632
[5,]  1.25282290  1.4032928 -1.1295793
attr(,"scaled:center")
  Income Children      Age 
    41.0      3.4     33.4 
attr(,"scaled:scale")
   Income  Children       Age 
15.165751  1.140175  7.436397 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"2D Approximation (X.star):"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2D Approximation (X.star):"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(X.star)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]       [,2]       [,3]
[1,]  0.26048350 -1.2630881 -0.1244430
[2,] -1.51239121  0.5127327  1.4296557
[3,]  0.21160127 -0.3214764 -0.1741349
[4,] -0.09109489 -0.3186221  0.1223452
[5,]  1.13140134  1.3904538 -1.2534230</code></pre>
</div>
</div>
</section>
<section id="a-word-of-caution-on-practical-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="a-word-of-caution-on-practical-data-analysis">A word of caution on practical data analysis</h2>
<p>One of the main aims of this course is to put you in a position of being able to perform the multivariate statistical analysis of your own research projects, in whatever field this may be. Most of the examples used in these notes are themselves real-world studies, and so you will get some idea of some of the complexities involved in gathering and analysing data. Having said that, there is an obvious need in an introductory course like this one to choose data sets that work’ and that can be used to illustrate the techniques. We therefore do not discuss many of the practical difficulties which inevitably arise when doing your own original research. As a result when these difficulties arise when it comes to doing your own research, you may look back on this course and think why weren’t we taught that?’ Unfortunately, the kinds of problems that can arise are so varied and require such different solutions that it is not possible to teach in a course such as this one. As Bartholemew et al.&nbsp;put it, only when one has a clear idea of where one is going is it possible to know the important questions which arise”. However, the following broad areas should be borne in mind whenever conducting an original analysis.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Missing Data
</div>
</div>
<div class="callout-body-container callout-body">
<p>Missing data can cause severe problems for many of the techniques we will consider. Most techniques will simply drop cases which possess missing data on <em>any</em> of the variables to be included in the analysis. When the number of variables is large, as is often the case in multivariate analyses, this can result in a substantial proportion of the sample being dropped. This proportion should always be noted early in the analysis. Another critical question to ask iswhy is the data missing?” and ’does the missing data introduce any bias into the results?” Often, it is the people with the most extreme views that turn up as missing data by refusing to answer certain questions, which is clearly biasing. Possible solutions are <em>mean replacement</em> or other <em>imputation</em> (replacement) techniques, but these are beyond the scope of this course.</p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sample Sizes
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is a general rule that the bigger the model you fit, the greater the number of cases you need. In univariate analysis and simple hypothesis testing, the calculation ofrequired’</p>
<p>sample sizes is reasonably straightforward, but in multivariate analysis there are only very rough guidelines where any exist at all. As a <em>very</em> rough guideline, most techniques require at least 10 respondents per parameter estimated. That means that in order to estimate a regression model with four independent variable, you need at least 50 respondents (not forgetting the constant term <span class="math inline">\(\beta_0\)</span>, there are 5 parameters to be estimated). When sample sizes are small, one should be very careful about drawing strong conclusions. This is a particular problem in student research, where sample sizes are typically very small.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Transformations
</div>
</div>
<div class="callout-body-container callout-body">
<p>Many statistical techniques assume that data are normally distributed. Although it is again beyond the scope of this course, it is often possible to transform data that is not normally distributed into something that <em>is</em> normally distributed by using some kind of transforming function. Taking the logarithm of a set of numbers, for example, often works, as does taking the square (both of these transformations work by sucking in’ the tails of the non-normal distributions). Where transformations do not help, the analyst must make a decision about whether the data is approximately normal’ or ‘normal enough’ to continue, or whether it is necessary to use other methods (like non-parametric statistics, which tend to be harder to use but do not make any distributional assumptions).</p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>